{"version":3,"sources":["../index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import {Component, PropTypes} from 'react'\n\nconst defaultName = () => 'validate-' + (Math.random() + '').slice(2, 7)\n\nconst warn = (...args) => {\n  if (typeof console !== 'undefined' && console.warn) console.warn(...args)\n}\n\nconst missingPromise = () => {\n  const msg = [\n    'Missing a Promise binding!',\n    'You should either have global \\'Promise\\' available',\n    'or introduce custom one as \\'Validate.usePromise(Promise)\\''\n  ].join('\\n')\n\n  warn(msg)\n  throw new Error('Missing a Promise binding')\n}\n\nmissingPromise.all = missingPromise\n\nconst validateMembers = (value, members) => {\n  const errors = Object.keys(members)\n    .reduce((errors, name) => {\n      return [...errors, ...members[name].errors]\n    }, [])\n  return errors\n}\n\nconst aborted = new Error('validation aborted')\n\nclass Validate extends Component {\n\n  static propTypes = {\n    children : PropTypes.func.isRequired,\n    explicit : PropTypes.bool,\n    name     : PropTypes.string,\n    parent   : PropTypes.shape({\n      name     : PropTypes.string,\n      onChange : PropTypes.func\n    }),\n    onChange   : PropTypes.func,\n    pristine   : PropTypes.bool,\n    valid      : PropTypes.bool,\n    validators : PropTypes.arrayOf(PropTypes.func),\n    value      : PropTypes.any\n  }\n\n  static defaultProps = {\n    parent     : null,\n    validators : [validateMembers],\n    value      : '',\n    explicit   : false,\n    onChange   : () => undefined\n  }\n\n  static Promise = typeof Promise === 'undefined' ? missingPromise : Promise\n\n  static usePromise = Promise => {\n    Validate.Promise = Promise\n    return Validate\n  }\n\n  constructor (...args) {\n    super(...args)\n\n    const {name, value} = this.props\n\n    this.name = name || defaultName()\n    this.state = {\n      value,\n      members  : {},\n      pristine : true,\n      pending  : false,\n      valid    : this.props.value !== undefined ? this.props.value : true,\n      errors   : []\n    }\n\n    this._validationRun = 0\n  }\n\n  check = () => {\n    this.setState({pristine: false})\n    const {value, members} = this.state\n    return this._validate(value, members).then(() => {\n      this.props.onChange(value, this.state.valid)\n      return this.state.valid\n    })\n  }\n\n  onChange = (value, silent = false) => {\n    const {explicit, onChange} = this.props\n    if (explicit) return this.setState({value})\n\n    const {pristine, members} = this.state\n\n    this.setState(state => ({...state,\n      value,\n      pristine: pristine && silent\n    }), () => {\n      this._validate(value, members).then(() => {\n        onChange(this.state.value, this.state.valid)\n      })\n    })\n  }\n\n  onReport = (name, member, pristine) => {\n    const {explicit} = this.props\n\n    this.setState(state => ({...state,\n      members  : {...state.members, [name]: member},\n      pristine : explicit ? state.pristine : (state.pristine && pristine)\n    }), () => {\n      if (!explicit) this._validate(this.state.value, this.state.members)\n    })\n  }\n\n  onLeave = name => {\n    const {explicit} = this.props\n    const {members} = this.state\n\n    if (!members[name]) return\n\n    const nextMembers = {...members}\n    delete nextMembers[name]\n\n    this.setState({\n      members: nextMembers\n    }, () => {\n      if (!explicit) this._validate(this.state.value, this.state.members)\n    })\n  }\n\n  componentDidMount () {\n    const {explicit, valid, value} = this.props\n    if (!explicit && valid === undefined) this._validate(value, {}, true)\n  }\n\n  componentWillUnmount () {\n    const {parent} = this.props\n    parent && parent.leave(this.name)\n  }\n\n  componentWillReceiveProps (nextProps) {\n    if (!(value in nextProps) || nextProps.value === this.state.value) return\n\n    const {value, parent, onChange} = nextProps\n    this._validate(value, this.state.members).then(() => {\n      onChange(this.state.value, this.state.valid)\n      parent && parent.report(this.name, this.state)\n    })\n  }\n\n  render () {\n    const {parent, children: render} = this.props\n    const opts = {\n      name     : this.name,\n      check    : this.check,\n      errors   : this.state.errors,\n      members  : this.state.members,\n      onChange : this.onChange,\n      pending  : this.state.pending,\n      pristine : (!parent || parent.pristine) && this.state.pristine,\n      valid    : this.state.valid,\n      value    : this.state.value\n    }\n\n    opts.group = {\n      pristine : opts.pristine,\n      report   : this.onReport,\n      check    : this.check\n    }\n\n    return render(opts)\n  }\n\n  _validate (value, members, pristine) {\n    let isAsync = false\n    const run = ++this._validationRun\n    const {validators, parent} = this.props\n\n    const errors = validators.reduce((errors, validate) => {\n      const error = validate(value, members || {})\n      if (error !== undefined && error !== null) {\n        isAsync = isAsync || !!error.then\n        return errors.concat(error) // either one or Array of errors\n      }\n      return errors\n    }, [])\n\n    if (isAsync) {\n      this.setState({pending: true})\n      return Promise.all(\n        errors.concat(run)\n      ).then(errors => {\n        if (errors.pop() !== this._validationRun) throw aborted\n        this.setState({\n          errors,\n          valid   : errors.length === 0,\n          pending : false\n        }, () => parent && parent.report(this.name, this.state, pristine))\n      }).catch(err => {\n        this.setState({pending: false})\n        if (err === aborted) return\n        warn('Validation failed', err)\n      })\n    } else {\n      this.setState({\n        errors,\n        valid: errors.length === 0\n      }, () => parent && parent.report(this.name, this.state, pristine))\n      return Promise.resolve()\n    }\n  }\n}\n\nexport default Validate\n"]}